@model UbannestEvents.Models.Event


@{
    ViewData["Title"] = $"{Model.Title.ToUpper()}";
}

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - Veranstaltungsdetails</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <head>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    </head>

</head>
<body>
    <div class="container py-5">

        <!--  Breadcrumb navigation -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb bg-light p-3 rounded shadow-sm">
                <li class="breadcrumb-item">
                    <a asp-controller="Home" asp-action="Index" class="text-decoration-none text-primary">Startseite</a>
                </li>
                <li class="breadcrumb-item">
                    <a asp-action="Index" class="text-decoration-none text-primary">Veranstaltungen</a>
                </li>
                <li class="breadcrumb-item active text-dark fw-semibold" aria-current="page">
                    @Model.Title.ToUpper()
                </li>
            </ol>
        </nav>

        <!-- Main image -->
        <div class="mb-5">
           @*  <img src="~/images/Cover/@Model.ImgageCovername"
            class="img-fluid rounded shadow-sm w-100"
            style="max-height: 500px; object-fit: cover;"
            alt="Bild der Veranstaltung @Model.Title" /> *@
            <img src="/images/Cover/@Model.ImgageCovername" class="card-img-top rounded-top-4" alt="@Model.Title" style="max-height:40vh; width:100%">
        </div>

        <!--  Description Details -->
        <div class="row gy-4 align-items-stretch">
            <!-- Description -->
            <div class="col-lg-8">
                <div class="container d-flex justify-content-between">
                    <h1 class="fw-bold mb-3">@Model.Title</h1>
                    @if (User.Identity.IsAuthenticated)
                    {
                        <form asp-controller="Favori"
                              asp-action="ToggleFavori"
                              asp-route-eventId="@Model.Id"
                             
                              method="post" class="d-inline">
                            <input type="hidden" name="EventID" value="@Model.Id" />
                            <button type="submit" class="btn btn-link p-0 border-0 text-end" title="Favori">


                                @if ((bool)ViewBag.EstFavori)
                                {
                                    <i class="fas fa-heart text-danger fa-2x"></i> <!-- Retirer des favoris -->
                                }
                                else
                                {
                                    <i class="far fa-heart text-secondary fa-2x"></i> <!-- Ajouter aux favoris -->
                                }
                                
                            </button>
                        </form>
                    }


                </div>
               
                <p><i class="fas fa-eye"></i> View : @Model.ViewCount</p>
                <p class="fs-5 text-muted">@Html.Raw(@Model.Description)</p>
            </div>

            <!-- Additional info -->
            <div class="col-lg-4">
                <div class="bg-light border-start border-4 border-primary rounded p-4 h-100 d-flex flex-column justify-content-center shadow-sm">
                    <h5 class="text-secondary mb-3">📅 Zeitraum</h5>
                    <p class="fw-bold text-dark mb-4">
                        Von <span class="text-primary">@Model.StartDate.ToString("dd MMM yyyy")</span><br />
                        bis <span class="text-primary">@Model.EndDate.ToString("dd MMM yyyy")</span>
                    </p>

                    <hr />
                    <p class="mb-0 text-muted ">Kategorie: <span class="badge bg-warning">@Model.Category?.Name</span></p>
                </div>
            </div>
        </div>

        <!--Kommentare -->
        <div class="mt-5">
            <h3 class="mb-4">💬 Kommentare</h3>

            <!-- Comment form -->
            <form method="post" asp-action="AddComment">
               
                @if (User.Identity.IsAuthenticated)
                {
                    <form method="post" asp-action="AddComment">
                        <input type="hidden" name="EventID" value="@Model.Id" />
                        <div class="mb-3">
                            <label for="message" class="form-label">Ihr Kommentar</label>
                            <textarea name="CommentText" rows="4" class="form-control" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Kommentar absenden</button>
                    </form>
                }
                else
                {
                    <div class="alert alert-warning mt-3">
                        <i class="bi bi-info-circle-fill me-2"></i>
                        <strong>Nur angemeldete Benutzer</strong> können Kommentare schreiben.
                        <a asp-controller="Account"
                           asp-action="Login"
                           asp-route-returnUrl="@Context.Request.Path" class="ms-2 text-decoration-underline">Einloggen</a>
                    </div>
                }


            </form>

            <!-- 💬 Liste des commentaires -->
            <div class="mt-5">
                <h5>🗨️ Letzte Kommentare</h5>

                @if (Model.Komments != null && Model.Komments.Any())
                {
                    <div class="comments-container">
                        @foreach (var obj in Model.Komments)
                        {
                            <div class="border rounded p-3 mb-3 shadow-sm">
                                <strong>@obj.User?.FullName</strong>
                                <span class="text-muted">am @obj.DatePosted.ToString("dd MMM yyyy")</span>
                                <p class="mb-0">@obj.CommenText</p>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <p class="text-muted fst-italic">Noch keine Kommentare.</p>
                }
            </div>

          

        </div>


    </div>
</body>
</html>
